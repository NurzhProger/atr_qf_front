import { Directive, EventEmitter, Input, Output, } from '@angular/core';
import { Subject, takeUntil } from 'rxjs';
import { filter, take } from 'rxjs/operators';
import { EventManager } from '../../event-manager/event-manager';
import * as i0 from "@angular/core";
import * as i1 from "../ya-map/ya-map.component";
/**
 * The `ya-object-manager` component wraps `ymaps.ObjectManager` class from the Yandex.Maps API.
 * You can configure it via the component's inputs.
 * Events can be bound using the outputs of the component.
 *
 * <example-url>https://stackblitz.com/edit/object-manager?embed=1&view=preview</example-url>
 *
 * @example
 * ```html
 * <ya-map [center]="[55.761952, 37.620739]">
 *   <ya-object-manager
 *     [options]="{ clusterize: true }"
 *     (ready)="onReady($event)"
 *   ></ya-object-manager>
 * </ya-map>
 * ```
 */
export class YaObjectManagerDirective {
    constructor(ngZone, yaMapComponent) {
        this.ngZone = ngZone;
        this.yaMapComponent = yaMapComponent;
        this.destroy$ = new Subject();
        this.eventManager = new EventManager(this.ngZone);
        /**
         * ObjectManager instance is added to a Map.
         */
        this.ready = new EventEmitter();
        /**
         * Single left-click on the object.
         * {@link https://yandex.com/dev/maps/jsapi/doc/2.1/ref/reference/IDomEventEmitter.html#event_detail__event-click}
         */
        this.yaclick = this.eventManager.getLazyEmitter('click');
        /**
         * Calls the element's context menu.
         * {@link https://yandex.com/dev/maps/jsapi/doc/2.1/ref/reference/IDomEventEmitter.html#event_detail__event-contextmenu}
         */
        this.yacontextmenu = this.eventManager.getLazyEmitter('contextmenu');
        /**
         * Double left-click on the object.
         * {@link https://yandex.com/dev/maps/jsapi/doc/2.1/ref/reference/IDomEventEmitter.html#event_detail__event-dblclick}
         */
        this.yadblclick = this.eventManager.getLazyEmitter('dblclick');
        /**
         * Change to the geo object geometry.
         * {@link https://yandex.com/dev/maps/jsapi/doc/2.1/ref/reference/IGeoObject.html#event_detail__event-geometrychange}
         */
        this.geometrychange = this.eventManager.getLazyEmitter('geometrychange');
        /**
         * Map reference changed.
         * {@link https://yandex.com/dev/maps/jsapi/doc/2.1/ref/reference/IParentOnMap.html#event_detail__event-mapchange}
         */
        this.mapchange = this.eventManager.getLazyEmitter('mapchange');
        /**
         * Pressing the mouse button over the object.
         * {@link https://yandex.com/dev/maps/jsapi/doc/2.1/ref/reference/IDomEventEmitter.html#event_detail__event-mousedown}
         */
        this.yamousedown = this.eventManager.getLazyEmitter('mousedown');
        /**
         * Pointing the cursor at the object.
         * {@link https://yandex.com/dev/maps/jsapi/doc/2.1/ref/reference/IDomEventEmitter.html#event_detail__event-mouseenter}
         */
        this.yamouseenter = this.eventManager.getLazyEmitter('mouseenter');
        /**
         * Moving the cursor off of the object.
         * {@link https://yandex.com/dev/maps/jsapi/doc/2.1/ref/reference/IDomEventEmitter.html#event_detail__event-mouseleave}
         */
        this.yamouseleave = this.eventManager.getLazyEmitter('mouseleave');
        /**
         * Moving the cursor over the object.
         * {@link https://yandex.com/dev/maps/jsapi/doc/2.1/ref/reference/IDomEventEmitter.html#event_detail__event-mousemove}
         */
        this.yamousemove = this.eventManager.getLazyEmitter('mousemove');
        /**
         * Letting go of the mouse button over an object.
         * {@link https://yandex.com/dev/maps/jsapi/doc/2.1/ref/reference/IDomEventEmitter.html#event_detail__event-mouseup}
         */
        this.yamouseup = this.eventManager.getLazyEmitter('mouseup');
        /**
         * End of multitouch.
         * {@link https://yandex.com/dev/maps/jsapi/doc/2.1/ref/reference/IDomEventEmitter.html#event_detail__event-multitouchend}
         */
        this.multitouchend = this.eventManager.getLazyEmitter('multitouchend');
        /**
         * Repeating event during multitouch.
         * {@link https://yandex.com/dev/maps/jsapi/doc/2.1/ref/reference/IDomEventEmitter.html#event_detail__event-multitouchmove}
         */
        this.multitouchmove = this.eventManager.getLazyEmitter('multitouchmove');
        /**
         * Start of multitouch.
         * {@link https://yandex.com/dev/maps/jsapi/doc/2.1/ref/reference/IDomEventEmitter.html#event_detail__event-multitouchstart}
         */
        this.multitouchstart = this.eventManager.getLazyEmitter('multitouchstart');
        /**
         * Change to the object options.
         * {@link https://yandex.com/dev/maps/jsapi/doc/2.1/ref/reference/ICustomizable.html#event_detail__event-optionschange}
         */
        this.optionschange = this.eventManager.getLazyEmitter('optionschange');
        /**
         * Change to the geo object overlay.
         * {@link https://yandex.com/dev/maps/jsapi/doc/2.1/ref/reference/IGeoObject.html#event_detail__event-overlaychange}
         */
        this.overlaychange = this.eventManager.getLazyEmitter('overlaychange');
        /**
         * The parent object reference changed.
         * {@link https://yandex.com/dev/maps/jsapi/doc/2.1/ref/reference/IChild.html#event_detail__event-parentchange}
         */
        this.parentchange = this.eventManager.getLazyEmitter('parentchange');
        /**
         * Change to the geo object data.
         * {@link https://yandex.com/dev/maps/jsapi/doc/2.1/ref/reference/IGeoObject.html#event_detail__event-propertieschange}
         */
        this.propertieschange = this.eventManager.getLazyEmitter('propertieschange');
        /**
         * Mouse wheel scrolling.
         * {@link https://yandex.com/dev/maps/jsapi/doc/2.1/ref/reference/IDomEventEmitter.html#event_detail__event-wheel}
         */
        this.yawheel = this.eventManager.getLazyEmitter('wheel');
    }
    /**
     * Handles input changes and passes them in API.
     * @param changes
     */
    ngOnChanges(changes) {
        const { objectManager } = this;
        if (objectManager) {
            const { options } = changes;
            if (options) {
                objectManager.options.set(options.currentValue);
            }
        }
    }
    ngOnInit() {
        this.yaMapComponent.map$
            .pipe(filter(Boolean), take(1), takeUntil(this.destroy$))
            .subscribe((map) => {
            const objectManager = this.createObjectManager();
            this.objectManager = objectManager;
            map.geoObjects.add(objectManager);
            this.eventManager.setTarget(objectManager);
            this.ngZone.run(() => this.ready.emit({ ymaps, target: objectManager }));
        });
    }
    ngOnDestroy() {
        if (this.objectManager) {
            this.yaMapComponent?.map$.value?.geoObjects.remove(this.objectManager);
            this.eventManager.destroy();
        }
        this.destroy$.next();
        this.destroy$.complete();
    }
    /**
     * Creates ObjectManager.
     */
    createObjectManager() {
        return new ymaps.ObjectManager(this.options);
    }
}
YaObjectManagerDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.5", ngImport: i0, type: YaObjectManagerDirective, deps: [{ token: i0.NgZone }, { token: i1.YaMapComponent }], target: i0.ɵɵFactoryTarget.Directive });
YaObjectManagerDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "14.2.5", type: YaObjectManagerDirective, selector: "ya-object-manager", inputs: { options: "options" }, outputs: { ready: "ready", yaclick: "yaclick", yacontextmenu: "yacontextmenu", yadblclick: "yadblclick", geometrychange: "geometrychange", mapchange: "mapchange", yamousedown: "yamousedown", yamouseenter: "yamouseenter", yamouseleave: "yamouseleave", yamousemove: "yamousemove", yamouseup: "yamouseup", multitouchend: "multitouchend", multitouchmove: "multitouchmove", multitouchstart: "multitouchstart", optionschange: "optionschange", overlaychange: "overlaychange", parentchange: "parentchange", propertieschange: "propertieschange", yawheel: "yawheel" }, usesOnChanges: true, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.5", ngImport: i0, type: YaObjectManagerDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: 'ya-object-manager',
                }]
        }], ctorParameters: function () { return [{ type: i0.NgZone }, { type: i1.YaMapComponent }]; }, propDecorators: { options: [{
                type: Input
            }], ready: [{
                type: Output
            }], yaclick: [{
                type: Output
            }], yacontextmenu: [{
                type: Output
            }], yadblclick: [{
                type: Output
            }], geometrychange: [{
                type: Output
            }], mapchange: [{
                type: Output
            }], yamousedown: [{
                type: Output
            }], yamouseenter: [{
                type: Output
            }], yamouseleave: [{
                type: Output
            }], yamousemove: [{
                type: Output
            }], yamouseup: [{
                type: Output
            }], multitouchend: [{
                type: Output
            }], multitouchmove: [{
                type: Output
            }], multitouchstart: [{
                type: Output
            }], optionschange: [{
                type: Output
            }], overlaychange: [{
                type: Output
            }], parentchange: [{
                type: Output
            }], propertieschange: [{
                type: Output
            }], yawheel: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoieWEtb2JqZWN0LW1hbmFnZXIuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvYW5ndWxhcjgteWFuZGV4LW1hcHMvc3JjL2xpYi9jb21wb25lbnRzL3lhLW9iamVjdC1tYW5hZ2VyL3lhLW9iamVjdC1tYW5hZ2VyLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULFlBQVksRUFDWixLQUFLLEVBS0wsTUFBTSxHQUVQLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBYyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3RELE9BQU8sRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFOUMsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLG1DQUFtQyxDQUFDOzs7QUFLakU7Ozs7Ozs7Ozs7Ozs7Ozs7R0FnQkc7QUFJSCxNQUFNLE9BQU8sd0JBQXdCO0lBa0puQyxZQUE2QixNQUFjLEVBQW1CLGNBQThCO1FBQS9ELFdBQU0sR0FBTixNQUFNLENBQVE7UUFBbUIsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBakozRSxhQUFRLEdBQUcsSUFBSSxPQUFPLEVBQVEsQ0FBQztRQUUvQixpQkFBWSxHQUFHLElBQUksWUFBWSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQVU5RDs7V0FFRztRQUNPLFVBQUssR0FBb0QsSUFBSSxZQUFZLEVBRWhGLENBQUM7UUFFSjs7O1dBR0c7UUFDTyxZQUFPLEdBQ2YsSUFBSSxDQUFDLFlBQVksQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLENBQUM7UUFFNUM7OztXQUdHO1FBQ08sa0JBQWEsR0FDckIsSUFBSSxDQUFDLFlBQVksQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLENBQUM7UUFFbEQ7OztXQUdHO1FBQ08sZUFBVSxHQUNsQixJQUFJLENB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T0csY0FBYztzQkFBdkIsTUFBTTtnQkFPRyxlQUFlO3NCQUF4QixNQUFNO2dCQU9HLGFBQWE7c0JBQXRCLE1BQU07Z0JBT0csYUFBYTtzQkFBdEIsTUFBTTtnQkFPRyxZQUFZO3NCQUFyQixNQUFNO2dCQU9HLGdCQUFnQjtzQkFBekIsTUFBTTtnQkFPRyxPQUFPO3NCQUFoQixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBEaXJlY3RpdmUsXHJcbiAgRXZlbnRFbWl0dGVyLFxyXG4gIElucHV0LFxyXG4gIE5nWm9uZSxcclxuICBPbkNoYW5nZXMsXHJcbiAgT25EZXN0cm95LFxyXG4gIE9uSW5pdCxcclxuICBPdXRwdXQsXHJcbiAgU2ltcGxlQ2hhbmdlcyxcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCwgdGFrZVVudGlsIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IGZpbHRlciwgdGFrZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuXHJcbmltcG9ydCB7IEV2ZW50TWFuYWdlciB9IGZyb20gJy4uLy4uL2V2ZW50LW1hbmFnZXIvZXZlbnQtbWFuYWdlcic7XHJcbmltcG9ydCB7IFlhRXZlbnQgfSBmcm9tICcuLi8uLi9tb2RlbHMveWEtZXZlbnQnO1xyXG5pbXBvcnQgeyBZYVJlYWR5RXZlbnQgfSBmcm9tICcuLi8uLi9tb2RlbHMveWEtcmVhZHktZXZlbnQnO1xyXG5pbXBvcnQgeyBZYU1hcENvbXBvbmVudCB9IGZyb20gJy4uL3lhLW1hcC95YS1tYXAuY29tcG9uZW50JztcclxuXHJcbi8qKlxyXG4gKiBUaGUgYHlhLW9iamVjdC1tYW5hZ2VyYCBjb21wb25lbnQgd3JhcHMgYHltYXBzLk9iamVjdE1hbmFnZXJgIGNsYXNzIGZyb20gdGhlIFlhbmRleC5NYXBzIEFQSS5cclxuICogWW91IGNhbiBjb25maWd1cmUgaXQgdmlhIHRoZSBjb21wb25lbnQncyBpbnB1dHMuXHJcbiAqIEV2ZW50cyBjYW4gYmUgYm91bmQgdXNpbmcgdGhlIG91dHB1dHMgb2YgdGhlIGNvbXBvbmVudC5cclxuICpcclxuICogPGV4YW1wbGUtdXJsPmh0dHBzOi8vc3RhY2tibGl0ei5jb20vZWRpdC9vYmplY3QtbWFuYWdlcj9lbWJlZD0xJnZpZXc9cHJldmlldzwvZXhhbXBsZS11cmw+XHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYGh0bWxcclxuICogPHlhLW1hcCBbY2VudGVyXT1cIls1NS43NjE5NTIsIDM3LjYyMDczOV1cIj5cclxuICogICA8eWEtb2JqZWN0LW1hbmFnZXJcclxuICogICAgIFtvcHRpb25zXT1cInsgY2x1c3Rlcml6ZTogdHJ1ZSB9XCJcclxuICogICAgIChyZWFkeSk9XCJvblJlYWR5KCRldmVudClcIlxyXG4gKiAgID48L3lhLW9iamVjdC1tYW5hZ2VyPlxyXG4gKiA8L3lhLW1hcD5cclxuICogYGBgXHJcbiAqL1xyXG5ARGlyZWN0aXZlKHtcclxuICBzZWxlY3RvcjogJ3lhLW9iamVjdC1tYW5hZ2VyJyxcclxufSlcclxuZXhwb3J0IGNsYXNzIFlhT2JqZWN0TWFuYWdlckRpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzLCBPbkRlc3Ryb3kge1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgZGVzdHJveSQgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IGV2ZW50TWFuYWdlciA9IG5ldyBFdmVudE1hbmFnZXIodGhpcy5uZ1pvbmUpO1xyXG5cclxuICBwcml2YXRlIG9iamVjdE1hbmFnZXI/OiB5bWFwcy5PYmplY3RNYW5hZ2VyO1xyXG5cclxuICAvKipcclxuICAgKiBPYmplY3RNYW5hZ2VyIG9wdGlvbnMuXHJcbiAgICoge0BsaW5rIGh0dHBzOi8veWFuZGV4LmNvbS9kZXYvbWFwcy9qc2FwaS9kb2MvMi4xL3JlZi9yZWZlcmVuY2UvT2JqZWN0TWFuYWdlci5odG1sI09iamVjdE1hbmFnZXJfX3BhcmFtLW9wdGlvbnN9XHJcbiAgICovXHJcbiAgQElucHV0KCkgb3B0aW9uczogeW1hcHMuSU9iamVjdE1hbmFnZXJPcHRpb25zO1xyXG5cclxuICAvKipcclxuICAgKiBPYmplY3RNYW5hZ2VyIGluc3RhbmNlIGlzIGFkZGVkIHRvIGEgTWFwLlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSByZWFkeTogRXZlbnRFbWl0dGVyPFlhUmVhZHlFdmVudDx5bWFwcy5PYmplY3RNYW5hZ2VyPj4gPSBuZXcgRXZlbnRFbWl0dGVyPFxyXG4gICAgWWFSZWFkeUV2ZW50PHltYXBzLk9iamVjdE1hbmFnZXI+XHJcbiAgPigpO1xyXG5cclxuICAvKipcclxuICAgKiBTaW5nbGUgbGVmdC1jbGljayBvbiB0aGUgb2JqZWN0LlxyXG4gICAqIHtAbGluayBodHRwczovL3lhbmRleC5jb20vZGV2L21hcHMvanNhcGkvZG9jLzIuMS9yZWYvcmVmZXJlbmNlL0lEb21FdmVudEVtaXR0ZXIuaHRtbCNldmVudF9kZXRhaWxfX2V2ZW50LWNsaWNrfVxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSB5YWNsaWNrOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuT2JqZWN0TWFuYWdlcj4+ID1cclxuICAgIHRoaXMuZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdjbGljaycpO1xyXG5cclxuICAvKipcclxuICAgKiBDYWxscyB0aGUgZWxlbWVudCdzIGNvbnRleHQgbWVudS5cclxuICAgKiB7QGxpbmsgaHR0cHM6Ly95YW5kZXguY29tL2Rldi9tYXBzL2pzYXBpL2RvYy8yLjEvcmVmL3JlZmVyZW5jZS9JRG9tRXZlbnRFbWl0dGVyLmh0bWwjZXZlbnRfZGV0YWlsX19ldmVudC1jb250ZXh0bWVudX1cclxuICAgKi9cclxuICBAT3V0cHV0KCkgeWFjb250ZXh0bWVudTogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLk9iamVjdE1hbmFnZXI+PiA9XHJcbiAgICB0aGlzLmV2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignY29udGV4dG1lbnUnKTtcclxuXHJcbiAgLyoqXHJcbiAgICogRG91YmxlIGxlZnQtY2xpY2sgb24gdGhlIG9iamVjdC5cclxuICAgKiB7QGxpbmsgaHR0cHM6Ly95YW5kZXguY29tL2Rldi9tYXBzL2pzYXBpL2RvYy8yLjEvcmVmL3JlZmVyZW5jZS9JRG9tRXZlbnRFbWl0dGVyLmh0bWwjZXZlbnRfZGV0YWlsX19ldmVudC1kYmxjbGlja31cclxuICAgKi9cclxuICBAT3V0cHV0KCkgeWFkYmxjbGljazogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLk9iamVjdE1hbmFnZXI+PiA9XHJcbiAgICB0aGlzLmV2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignZGJsY2xpY2snKTtcclxuXHJcbiAgLyoqXHJcbiAgICogQ2hhbmdlIHRvIHRoZSBnZW8gb2JqZWN0IGdlb21ldHJ5LlxyXG4gICAqIHtAbGluayBodHRwczovL3lhbmRleC5jb20vZGV2L21hcHMvanNhcGkvZG9jLzIuMS9yZWYvcmVmZXJlbmNlL0lHZW9PYmplY3QuaHRtbCNldmVudF9kZXRhaWxfX2V2ZW50LWdlb21ldHJ5Y2hhbmdlfVxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSBnZW9tZXRyeWNoYW5nZTogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLk9iamVjdE1hbmFnZXI+PiA9XHJcbiAgICB0aGlzLmV2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignZ2VvbWV0cnljaGFuZ2UnKTtcclxuXHJcbiAgLyoqXHJcbiAgICogTWFwIHJlZmVyZW5jZSBjaGFuZ2VkLlxyXG4gICAqIHtAbGluayBodHRwczovL3lhbmRleC5jb20vZGV2L21hcHMvanNhcGkvZG9jLzIuMS9yZWYvcmVmZXJlbmNlL0lQYXJlbnRPbk1hcC5odG1sI2V2ZW50X2RldGFpbF9fZXZlbnQtbWFwY2hhbmdlfVxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSBtYXBjaGFuZ2U6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5PYmplY3RNYW5hZ2VyPj4gPVxyXG4gICAgdGhpcy5ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ21hcGNoYW5nZScpO1xyXG5cclxuICAvKipcclxuICAgKiBQcmVzc2luZyB0aGUgbW91c2UgYnV0dG9uIG92ZXIgdGhlIG9iamVjdC5cclxuICAgKiB7QGxpbmsgaHR0cHM6Ly95YW5kZXguY29tL2Rldi9tYXBzL2pzYXBpL2RvYy8yLjEvcmVmL3JlZmVyZW5jZS9JRG9tRXZlbnRFbWl0dGVyLmh0bWwjZXZlbnRfZGV0YWlsX19ldmVudC1tb3VzZWRvd259XHJcbiAgICovXHJcbiAgQE91dHB1dCgpIHlhbW91c2Vkb3duOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuT2JqZWN0TWFuYWdlcj4+ID1cclxuICAgIHRoaXMuZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdtb3VzZWRvd24nKTtcclxuXHJcbiAgLyoqXHJcbiAgICogUG9pbnRpbmcgdGhlIGN1cnNvciBhdCB0aGUgb2JqZWN0LlxyXG4gICAqIHtAbGluayBodHRwczovL3lhbmRleC5jb20vZGV2L21hcHMvanNhcGkvZG9jLzIuMS9yZWYvcmVmZXJlbmNlL0lEb21FdmVudEVtaXR0ZXIuaHRtbCNldmVudF9kZXRhaWxfX2V2ZW50LW1vdXNlZW50ZXJ9XHJcbiAgICovXHJcbiAgQE91dHB1dCgpIHlhbW91c2VlbnRlcjogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLk9iamVjdE1hbmFnZXI+PiA9XHJcbiAgICB0aGlzLmV2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignbW91c2VlbnRlcicpO1xyXG5cclxuICAvKipcclxuICAgKiBNb3ZpbmcgdGhlIGN1cnNvciBvZmYgb2YgdGhlIG9iamVjdC5cclxuICAgKiB7QGxpbmsgaHR0cHM6Ly95YW5kZXguY29tL2Rldi9tYXBzL2pzYXBpL2RvYy8yLjEvcmVmL3JlZmVyZW5jZS9JRG9tRXZlbnRFbWl0dGVyLmh0bWwjZXZlbnRfZGV0YWlsX19ldmVudC1tb3VzZWxlYXZlfVxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSB5YW1vdXNlbGVhdmU6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5PYmplY3RNYW5hZ2VyPj4gPVxyXG4gICAgdGhpcy5ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ21vdXNlbGVhdmUnKTtcclxuXHJcbiAgLyoqXHJcbiAgICogTW92aW5nIHRoZSBjdXJzb3Igb3ZlciB0aGUgb2JqZWN0LlxyXG4gICAqIHtAbGluayBodHRwczovL3lhbmRleC5jb20vZGV2L21hcHMvanNhcGkvZG9jLzIuMS9yZWYvcmVmZXJlbmNlL0lEb21FdmVudEVtaXR0ZXIuaHRtbCNldmVudF9kZXRhaWxfX2V2ZW50LW1vdXNlbW92ZX1cclxuICAgKi9cclxuICBAT3V0cHV0KCkgeWFtb3VzZW1vdmU6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5PYmplY3RNYW5hZ2VyPj4gPVxyXG4gICAgdGhpcy5ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ21vdXNlbW92ZScpO1xyXG5cclxuICAvKipcclxuICAgKiBMZXR0aW5nIGdvIG9mIHRoZSBtb3VzZSBidXR0b24gb3ZlciBhbiBvYmplY3QuXHJcbiAgICoge0BsaW5rIGh0dHBzOi8veWFuZGV4LmNvbS9kZXYvbWFwcy9qc2FwaS9kb2MvMi4xL3JlZi9yZWZlcmVuY2UvSURvbUV2ZW50RW1pdHRlci5odG1sI2V2ZW50X2RldGFpbF9fZXZlbnQtbW91c2V1cH1cclxuICAgKi9cclxuICBAT3V0cHV0KCkgeWFtb3VzZXVwOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuT2JqZWN0TWFuYWdlcj4+ID1cclxuICAgIHRoaXMuZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdtb3VzZXVwJyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIEVuZCBvZiBtdWx0aXRvdWNoLlxyXG4gICAqIHtAbGluayBodHRwczovL3lhbmRleC5jb20vZGV2L21hcHMvanNhcGkvZG9jLzIuMS9yZWYvcmVmZXJlbmNlL0lEb21FdmVudEVtaXR0ZXIuaHRtbCNldmVudF9kZXRhaWxfX2V2ZW50LW11bHRpdG91Y2hlbmR9XHJcbiAgICovXHJcbiAgQE91dHB1dCgpIG11bHRpdG91Y2hlbmQ6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5PYmplY3RNYW5hZ2VyPj4gPVxyXG4gICAgdGhpcy5ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ211bHRpdG91Y2hlbmQnKTtcclxuXHJcbiAgLyoqXHJcbiAgICogUmVwZWF0aW5nIGV2ZW50IGR1cmluZyBtdWx0aXRvdWNoLlxyXG4gICAqIHtAbGluayBodHRwczovL3lhbmRleC5jb20vZGV2L21hcHMvanNhcGkvZG9jLzIuMS9yZWYvcmVmZXJlbmNlL0lEb21FdmVudEVtaXR0ZXIuaHRtbCNldmVudF9kZXRhaWxfX2V2ZW50LW11bHRpdG91Y2htb3ZlfVxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSBtdWx0aXRvdWNobW92ZTogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLk9iamVjdE1hbmFnZXI+PiA9XHJcbiAgICB0aGlzLmV2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignbXVsdGl0b3VjaG1vdmUnKTtcclxuXHJcbiAgLyoqXHJcbiAgICogU3RhcnQgb2YgbXVsdGl0b3VjaC5cclxuICAgKiB7QGxpbmsgaHR0cHM6Ly95YW5kZXguY29tL2Rldi9tYXBzL2pzYXBpL2RvYy8yLjEvcmVmL3JlZmVyZW5jZS9JRG9tRXZlbnRFbWl0dGVyLmh0bWwjZXZlbnRfZGV0YWlsX19ldmVudC1tdWx0aXRvdWNoc3RhcnR9XHJcbiAgICovXHJcbiAgQE91dHB1dCgpIG11bHRpdG91Y2hzdGFydDogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLk9iamVjdE1hbmFnZXI+PiA9XHJcbiAgICB0aGlzLmV2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignbXVsdGl0b3VjaHN0YXJ0Jyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIENoYW5nZSB0byB0aGUgb2JqZWN0IG9wdGlvbnMuXHJcbiAgICoge0BsaW5rIGh0dHBzOi8veWFuZGV4LmNvbS9kZXYvbWFwcy9qc2FwaS9kb2MvMi4xL3JlZi9yZWZlcmVuY2UvSUN1c3RvbWl6YWJsZS5odG1sI2V2ZW50X2RldGFpbF9fZXZlbnQtb3B0aW9uc2NoYW5nZX1cclxuICAgKi9cclxuICBAT3V0cHV0KCkgb3B0aW9uc2NoYW5nZTogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLk9iamVjdE1hbmFnZXI+PiA9XHJcbiAgICB0aGlzLmV2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignb3B0aW9uc2NoYW5nZScpO1xyXG5cclxuICAvKipcclxuICAgKiBDaGFuZ2UgdG8gdGhlIGdlbyBvYmplY3Qgb3ZlcmxheS5cclxuICAgKiB7QGxpbmsgaHR0cHM6Ly95YW5kZXguY29tL2Rldi9tYXBzL2pzYXBpL2RvYy8yLjEvcmVmL3JlZmVyZW5jZS9JR2VvT2JqZWN0Lmh0bWwjZXZlbnRfZGV0YWlsX19ldmVudC1vdmVybGF5Y2hhbmdlfVxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSBvdmVybGF5Y2hhbmdlOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuT2JqZWN0TWFuYWdlcj4+ID1cclxuICAgIHRoaXMuZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdvdmVybGF5Y2hhbmdlJyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIFRoZSBwYXJlbnQgb2JqZWN0IHJlZmVyZW5jZSBjaGFuZ2VkLlxyXG4gICAqIHtAbGluayBodHRwczovL3lhbmRleC5jb20vZGV2L21hcHMvanNhcGkvZG9jLzIuMS9yZWYvcmVmZXJlbmNlL0lDaGlsZC5odG1sI2V2ZW50X2RldGFpbF9fZXZlbnQtcGFyZW50Y2hhbmdlfVxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSBwYXJlbnRjaGFuZ2U6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5PYmplY3RNYW5hZ2VyPj4gPVxyXG4gICAgdGhpcy5ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ3BhcmVudGNoYW5nZScpO1xyXG5cclxuICAvKipcclxuICAgKiBDaGFuZ2UgdG8gdGhlIGdlbyBvYmplY3QgZGF0YS5cclxuICAgKiB7QGxpbmsgaHR0cHM6Ly95YW5kZXguY29tL2Rldi9tYXBzL2pzYXBpL2RvYy8yLjEvcmVmL3JlZmVyZW5jZS9JR2VvT2JqZWN0Lmh0bWwjZXZlbnRfZGV0YWlsX19ldmVudC1wcm9wZXJ0aWVzY2hhbmdlfVxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSBwcm9wZXJ0aWVzY2hhbmdlOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuT2JqZWN0TWFuYWdlcj4+ID1cclxuICAgIHRoaXMuZXZlbnRNYW5hZ2VyLmdldExhenlFbWl0dGVyKCdwcm9wZXJ0aWVzY2hhbmdlJyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIE1vdXNlIHdoZWVsIHNjcm9sbGluZy5cclxuICAgKiB7QGxpbmsgaHR0cHM6Ly95YW5kZXguY29tL2Rldi9tYXBzL2pzYXBpL2RvYy8yLjEvcmVmL3JlZmVyZW5jZS9JRG9tRXZlbnRFbWl0dGVyLmh0bWwjZXZlbnRfZGV0YWlsX19ldmVudC13aGVlbH1cclxuICAgKi9cclxuICBAT3V0cHV0KCkgeWF3aGVlbDogT2JzZXJ2YWJsZTxZYUV2ZW50PHltYXBzLk9iamVjdE1hbmFnZXI+PiA9XHJcbiAgICB0aGlzLmV2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignd2hlZWwnKTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBuZ1pvbmU6IE5nWm9uZSwgcHJpdmF0ZSByZWFkb25seSB5YU1hcENvbXBvbmVudDogWWFNYXBDb21wb25lbnQpIHt9XHJcblxyXG4gIC8qKlxyXG4gICAqIEhhbmRsZXMgaW5wdXQgY2hhbmdlcyBhbmQgcGFzc2VzIHRoZW0gaW4gQVBJLlxyXG4gICAqIEBwYXJhbSBjaGFuZ2VzXHJcbiAgICovXHJcbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgY29uc3QgeyBvYmplY3RNYW5hZ2VyIH0gPSB0aGlzO1xyXG5cclxuICAgIGlmIChvYmplY3RNYW5hZ2VyKSB7XHJcbiAgICAgIGNvbnN0IHsgb3B0aW9ucyB9ID0gY2hhbmdlcztcclxuXHJcbiAgICAgIGlmIChvcHRpb25zKSB7XHJcbiAgICAgICAgb2JqZWN0TWFuYWdlci5vcHRpb25zLnNldChvcHRpb25zLmN1cnJlbnRWYWx1ZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgdGhpcy55YU1hcENvbXBvbmVudC5tYXAkXHJcbiAgICAgIC5waXBlKGZpbHRlcihCb29sZWFuKSwgdGFrZSgxKSwgdGFrZVVudGlsKHRoaXMuZGVzdHJveSQpKVxyXG4gICAgICAuc3Vic2NyaWJlKChtYXApID0+IHtcclxuICAgICAgICBjb25zdCBvYmplY3RNYW5hZ2VyID0gdGhpcy5jcmVhdGVPYmplY3RNYW5hZ2VyKCk7XHJcbiAgICAgICAgdGhpcy5vYmplY3RNYW5hZ2VyID0gb2JqZWN0TWFuYWdlcjtcclxuXHJcbiAgICAgICAgbWFwLmdlb09iamVjdHMuYWRkKG9iamVjdE1hbmFnZXIpO1xyXG4gICAgICAgIHRoaXMuZXZlbnRNYW5hZ2VyLnNldFRhcmdldChvYmplY3RNYW5hZ2VyKTtcclxuICAgICAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4gdGhpcy5yZWFkeS5lbWl0KHsgeW1hcHMsIHRhcmdldDogb2JqZWN0TWFuYWdlciB9KSk7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5vYmplY3RNYW5hZ2VyKSB7XHJcbiAgICAgIHRoaXMueWFNYXBDb21wb25lbnQ/Lm1hcCQudmFsdWU/Lmdlb09iamVjdHMucmVtb3ZlKHRoaXMub2JqZWN0TWFuYWdlcik7XHJcbiAgICAgIHRoaXMuZXZlbnRNYW5hZ2VyLmRlc3Ryb3koKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmRlc3Ryb3kkLm5leHQoKTtcclxuICAgIHRoaXMuZGVzdHJveSQuY29tcGxldGUoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZXMgT2JqZWN0TWFuYWdlci5cclxuICAgKi9cclxuICBwcml2YXRlIGNyZWF0ZU9iamVjdE1hbmFnZXIoKTogeW1hcHMuT2JqZWN0TWFuYWdlciB7XHJcbiAgICByZXR1cm4gbmV3IHltYXBzLk9iamVjdE1hbmFnZXIodGhpcy5vcHRpb25zKTtcclxuICB9XHJcbn1cclxuIl19