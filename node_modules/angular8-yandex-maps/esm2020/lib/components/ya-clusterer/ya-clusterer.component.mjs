import { ChangeDetectionStrategy, Component, ContentChildren, EventEmitter, Input, Output, } from '@angular/core';
import { Subject, takeUntil } from 'rxjs';
import { filter, take } from 'rxjs/operators';
import { EventManager } from '../../event-manager/event-manager';
import { YaGeoObjectDirective } from '../ya-geoobject/ya-geoobject.directive';
import { YaPlacemarkDirective } from '../ya-placemark/ya-placemark.directive';
import * as i0 from "@angular/core";
import * as i1 from "../ya-map/ya-map.component";
/**
 * The `ya-clusterer` component wraps `ymaps.Clusterer` class from the Yandex.Maps API.
 * You can configure it via the component's inputs.
 * Events can be bound using the outputs of the component.
 *
 * <example-url>https://stackblitz.com/edit/placemark-clusterer?embed=1&view=preview</example-url>
 *
 * @example
 * ```html
 * <ya-map [center]="[55.761952, 37.620739]">
 *   <ya-clusterer [options]="{ minClusterSize: 5 }">
 *     <ya-placemark [geometry]="[55.74, 37.5]"></ya-placemark>
 *     <ya-placemark [geometry]="[55.64, 37.46]"></ya-placemark>
 *     <ya-placemark [geometry]="[55.75, 37.38]"></ya-placemark>
 *
 *     <ya-geoobject
 *       [feature]="{ geometry: { type: 'Point', coordinates: [55.81, 37.4] } }"
 *      ></ya-geoobject>
 *
 *     <ya-geoobject
 *       [feature]="{ geometry: { type: 'Point', coordinates: [55.7, 37.39] } }"
 *      ></ya-geoobject>
 *   </ya-clusterer>
 * </ya-map>
 * ```
 */
export class YaClustererComponent {
    constructor(ngZone, yaMapComponent) {
        this.ngZone = ngZone;
        this.yaMapComponent = yaMapComponent;
        this.destroy$ = new Subject();
        this.eventManager = new EventManager(this.ngZone);
        /**
         * Clusterer instance is added to a Map.
         */
        this.ready = new EventEmitter();
        /**
         * Closing the hint.
         * {@link https://yandex.com/dev/maps/jsapi/doc/2.1/ref/reference/Clusterer.html#event_detail__event-hintclose}
         */
        this.hintclose = this.eventManager.getLazyEmitter('hintclose');
        /**
         * Opening a hint on a map.
         * {@link https://yandex.com/dev/maps/jsapi/doc/2.1/ref/reference/Clusterer.html#event_detail__event-hintopen}
         */
        this.hintopen = this.eventManager.getLazyEmitter('hintopen');
        /**
         * Map reference changed.
         * {@link https://yandex.com/dev/maps/jsapi/doc/2.1/ref/reference/IParentOnMap.html#event_detail__event-mapchange}
         */
        this.mapchange = this.eventManager.getLazyEmitter('mapchange');
        /**
         * Change to the object options.
         * {@link https://yandex.com/dev/maps/jsapi/doc/2.1/ref/reference/ICustomizable.html#event_detail__event-optionschange}
         */
        this.optionschange = this.eventManager.getLazyEmitter('optionschange');
        /**
         * The parent object reference changed.
         * {@link https://yandex.com/dev/maps/jsapi/doc/2.1/ref/reference/IChild.html#event_detail__event-parentchange}
         */
        this.parentchange = this.eventManager.getLazyEmitter('parentchange');
    }
    /**
     * Handles input changes and passes them in API.
     * @param changes
     */
    ngOnChanges(changes) {
        const { clusterer } = this;
        if (clusterer) {
            const { options } = changes;
            if (options) {
                clusterer.options.set(options.currentValue);
            }
        }
    }
    ngAfterContentInit() {
        this.yaMapComponent.map$
            .pipe(filter(Boolean), take(1), takeUntil(this.destroy$))
            .subscribe((map) => {
            const clusterer = this.createClusterer();
            this.clusterer = clusterer;
            map.geoObjects.add(clusterer);
            this.eventManager.setTarget(clusterer);
            this.watchForContentChanges(clusterer);
            this.ngZone.run(() => this.ready.emit({ ymaps, target: clusterer }));
        });
    }
    ngOnDestroy() {
        this.eventManager.destroy();
        this.destroy$.next();
        this.destroy$.complete();
    }
    /**
     * Creates Clusterer.
     */
    createClusterer() {
        return new ymaps.Clusterer(this.options);
    }
    watchForContentChanges(clusterer) {
        // Adds new Placemarks to the clusterer on changes.
        const currentPlacemarks = new Set();
        this.getInternalPlacemarks(this.placemarks.toArray()).forEach((placemark) => {
            currentPlacemarks.add(placemark);
            clusterer.add(placemark);
        });
        this.placemarks.changes
            .pipe(takeUntil(this.destroy$))
            .subscribe((placemarkDirectives) => {
            const newPlacemarks = new Set(this.getInternalPlacemarks(placemarkDirectives));
            const difference = this.getDifference(newPlacemarks, currentPlacemarks);
            clusterer.add(difference.toAdd);
            clusterer.remove(difference.toRemove);
        });
        // Adds new GeoObjects to the clusterer on changes.
        const currentGeoObjects = new Set();
        this.getInternalGeoObjects(this.geoObjects.toArray()).forEach((geoObject) => {
            currentGeoObjects.add(geoObject);
            clusterer.add(geoObject);
        });
        this.geoObjects.changes
            .pipe(takeUntil(this.destroy$))
            .subscribe((geoObjectDirectives) => {
            const newGeoObjects = new Set(this.getInternalGeoObjects(geoObjectDirectives));
            const difference = this.getDifference(newGeoObjects, currentGeoObjects);
            clusterer.add(difference.toAdd);
            clusterer.remove(difference.toRemove);
        });
    }
    /**
     * Determines what should be added/removed in current set to equal new set
     *
     * @param newSet
     * @param currentSet
     */
    getDifference(newSet, currentSet) {
        const toAdd = [];
        const toRemove = [];
        newSet.forEach((component) => {
            if (!currentSet.has(component)) {
                toAdd.push(component);
                currentSet.add(component);
            }
        });
        currentSet.forEach((component) => {
            if (!newSet.has(component)) {
                toRemove.push(component);
                currentSet.delete(component);
            }
        });
        return {
            toAdd,
            toRemove,
        };
    }
    getInternalPlacemarks(placemarks) {
        return placemarks
            .filter((component) => !!component.placemark)
            .map((component) => component.placemark);
    }
    getInternalGeoObjects(geoObjects) {
        return geoObjects
            .filter((component) => !!component.geoObject)
            .map((component) => component.geoObject);
    }
}
YaClustererComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.5", ngImport: i0, type: YaClustererComponent, deps: [{ token: i0.NgZone }, { token: i1.YaMapComponent }], target: i0.ɵɵFactoryTarget.Component });
YaClustererComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "14.2.5", type: YaClustererComponent, selector: "ya-clusterer", inputs: { options: "options" }, outputs: { ready: "ready", hintclose: "hintclose", hintopen: "hintopen", mapchange: "mapchange", optionschange: "optionschange", parentchange: "parentchange" }, queries: [{ propertyName: "placemarks", predicate: YaPlacemarkDirective }, { propertyName: "geoObjects", predicate: YaGeoObjectDirective }], usesOnChanges: true, ngImport: i0, template: '<ng-content></ng-content>', isInline: true, changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.5", ngImport: i0, type: YaClustererComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'ya-clusterer',
                    template: '<ng-content></ng-content>',
                    changeDetection: ChangeDetectionStrategy.OnPush,
                }]
        }], ctorParameters: function () { return [{ type: i0.NgZone }, { type: i1.YaMapComponent }]; }, propDecorators: { placemarks: [{
                type: ContentChildren,
                args: [YaPlacemarkDirective]
            }], geoObjects: [{
                type: ContentChildren,
                args: [YaGeoObjectDirective]
            }], options: [{
                type: Input
            }], ready: [{
                type: Output
            }], hintclose: [{
                type: Output
            }], hintopen: [{
                type: Output
            }], mapchange: [{
                type: Output
            }], optionschange: [{
                type: Output
            }], parentchange: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoieWEtY2x1c3RlcmVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2FuZ3VsYXI4LXlhbmRleC1tYXBzL3NyYy9saWIvY29tcG9uZW50cy95YS1jbHVzdGVyZXIveWEtY2x1c3RlcmVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBRUwsdUJBQXVCLEVBQ3ZCLFNBQVMsRUFDVCxlQUFlLEVBQ2YsWUFBWSxFQUNaLEtBQUssRUFJTCxNQUFNLEdBR1AsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFjLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdEQsT0FBTyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUU5QyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFHakUsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFFOUUsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sd0NBQXdDLENBQUM7OztBQUU5RTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQXlCRztBQU1ILE1BQU0sT0FBTyxvQkFBb0I7SUE2RC9CLFlBQTZCLE1BQWMsRUFBbUIsY0FBOEI7UUFBL0QsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUFtQixtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUF0RDNFLGFBQVEsR0FBRyxJQUFJLE9BQU8sRUFBUSxDQUFDO1FBRS9CLGlCQUFZLEdBQUcsSUFBSSxZQUFZLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBVTlEOztXQUVHO1FBQ08sVUFBSyxHQUFnRCxJQUFJLFlBQVksRUFFNUUsQ0FBQztRQUVKOzs7V0FHRztRQUNPLGNBQVMsR0FDakIsSUFBSSxDQUFDLFlBQVksQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFDLENBQUM7UUFF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QyxTQUFVLENBQUMsQ0FBQztJQUM5QyxDQUFDOztpSEE5TFUsb0JBQW9CO3FHQUFwQixvQkFBb0IsZ1JBQ2Qsb0JBQW9CLDZDQUdwQixvQkFBb0Isa0RBUDNCLDJCQUEyQjsyRkFHMUIsb0JBQW9CO2tCQUxoQyxTQUFTO21CQUFDO29CQUNULFFBQVEsRUFBRSxjQUFjO29CQUN4QixRQUFRLEVBQUUsMkJBQTJCO29CQUNyQyxlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTtpQkFDaEQ7MEhBR2tCLFVBQVU7c0JBRDFCLGVBQWU7dUJBQUMsb0JBQW9CO2dCQUlwQixVQUFVO3NCQUQxQixlQUFlO3VCQUFDLG9CQUFvQjtnQkFhNUIsT0FBTztzQkFBZixLQUFLO2dCQUtJLEtBQUs7c0JBQWQsTUFBTTtnQkFRRyxTQUFTO3NCQUFsQixNQUFNO2dCQU9HLFFBQVE7c0JBQWpCLE1BQU07Z0JBT0csU0FBUztzQkFBbEIsTUFBTTtnQkFPRyxhQUFhO3NCQUF0QixNQUFNO2dCQU9HLFlBQVk7c0JBQXJCLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIEFmdGVyQ29udGVudEluaXQsXHJcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXHJcbiAgQ29tcG9uZW50LFxyXG4gIENvbnRlbnRDaGlsZHJlbixcclxuICBFdmVudEVtaXR0ZXIsXHJcbiAgSW5wdXQsXHJcbiAgTmdab25lLFxyXG4gIE9uQ2hhbmdlcyxcclxuICBPbkRlc3Ryb3ksXHJcbiAgT3V0cHV0LFxyXG4gIFF1ZXJ5TGlzdCxcclxuICBTaW1wbGVDaGFuZ2VzLFxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0LCB0YWtlVW50aWwgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgZmlsdGVyLCB0YWtlIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5cclxuaW1wb3J0IHsgRXZlbnRNYW5hZ2VyIH0gZnJvbSAnLi4vLi4vZXZlbnQtbWFuYWdlci9ldmVudC1tYW5hZ2VyJztcclxuaW1wb3J0IHsgWWFFdmVudCB9IGZyb20gJy4uLy4uL21vZGVscy95YS1ldmVudCc7XHJcbmltcG9ydCB7IFlhUmVhZHlFdmVudCB9IGZyb20gJy4uLy4uL21vZGVscy95YS1yZWFkeS1ldmVudCc7XHJcbmltcG9ydCB7IFlhR2VvT2JqZWN0RGlyZWN0aXZlIH0gZnJvbSAnLi4veWEtZ2Vvb2JqZWN0L3lhLWdlb29iamVjdC5kaXJlY3RpdmUnO1xyXG5pbXBvcnQgeyBZYU1hcENvbXBvbmVudCB9IGZyb20gJy4uL3lhLW1hcC95YS1tYXAuY29tcG9uZW50JztcclxuaW1wb3J0IHsgWWFQbGFjZW1hcmtEaXJlY3RpdmUgfSBmcm9tICcuLi95YS1wbGFjZW1hcmsveWEtcGxhY2VtYXJrLmRpcmVjdGl2ZSc7XHJcblxyXG4vKipcclxuICogVGhlIGB5YS1jbHVzdGVyZXJgIGNvbXBvbmVudCB3cmFwcyBgeW1hcHMuQ2x1c3RlcmVyYCBjbGFzcyBmcm9tIHRoZSBZYW5kZXguTWFwcyBBUEkuXHJcbiAqIFlvdSBjYW4gY29uZmlndXJlIGl0IHZpYSB0aGUgY29tcG9uZW50J3MgaW5wdXRzLlxyXG4gKiBFdmVudHMgY2FuIGJlIGJvdW5kIHVzaW5nIHRoZSBvdXRwdXRzIG9mIHRoZSBjb21wb25lbnQuXHJcbiAqXHJcbiAqIDxleGFtcGxlLXVybD5odHRwczovL3N0YWNrYmxpdHouY29tL2VkaXQvcGxhY2VtYXJrLWNsdXN0ZXJlcj9lbWJlZD0xJnZpZXc9cHJldmlldzwvZXhhbXBsZS11cmw+XHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYGh0bWxcclxuICogPHlhLW1hcCBbY2VudGVyXT1cIls1NS43NjE5NTIsIDM3LjYyMDczOV1cIj5cclxuICogICA8eWEtY2x1c3RlcmVyIFtvcHRpb25zXT1cInsgbWluQ2x1c3RlclNpemU6IDUgfVwiPlxyXG4gKiAgICAgPHlhLXBsYWNlbWFyayBbZ2VvbWV0cnldPVwiWzU1Ljc0LCAzNy41XVwiPjwveWEtcGxhY2VtYXJrPlxyXG4gKiAgICAgPHlhLXBsYWNlbWFyayBbZ2VvbWV0cnldPVwiWzU1LjY0LCAzNy40Nl1cIj48L3lhLXBsYWNlbWFyaz5cclxuICogICAgIDx5YS1wbGFjZW1hcmsgW2dlb21ldHJ5XT1cIls1NS43NSwgMzcuMzhdXCI+PC95YS1wbGFjZW1hcms+XHJcbiAqXHJcbiAqICAgICA8eWEtZ2Vvb2JqZWN0XHJcbiAqICAgICAgIFtmZWF0dXJlXT1cInsgZ2VvbWV0cnk6IHsgdHlwZTogJ1BvaW50JywgY29vcmRpbmF0ZXM6IFs1NS44MSwgMzcuNF0gfSB9XCJcclxuICogICAgICA+PC95YS1nZW9vYmplY3Q+XHJcbiAqXHJcbiAqICAgICA8eWEtZ2Vvb2JqZWN0XHJcbiAqICAgICAgIFtmZWF0dXJlXT1cInsgZ2VvbWV0cnk6IHsgdHlwZTogJ1BvaW50JywgY29vcmRpbmF0ZXM6IFs1NS43LCAzNy4zOV0gfSB9XCJcclxuICogICAgICA+PC95YS1nZW9vYmplY3Q+XHJcbiAqICAgPC95YS1jbHVzdGVyZXI+XHJcbiAqIDwveWEtbWFwPlxyXG4gKiBgYGBcclxuICovXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAneWEtY2x1c3RlcmVyJyxcclxuICB0ZW1wbGF0ZTogJzxuZy1jb250ZW50PjwvbmctY29udGVudD4nLFxyXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgWWFDbHVzdGVyZXJDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlckNvbnRlbnRJbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB7XHJcbiAgQENvbnRlbnRDaGlsZHJlbihZYVBsYWNlbWFya0RpcmVjdGl2ZSlcclxuICBwcml2YXRlIHJlYWRvbmx5IHBsYWNlbWFya3M6IFF1ZXJ5TGlzdDxZYVBsYWNlbWFya0RpcmVjdGl2ZT47XHJcblxyXG4gIEBDb250ZW50Q2hpbGRyZW4oWWFHZW9PYmplY3REaXJlY3RpdmUpXHJcbiAgcHJpdmF0ZSByZWFkb25seSBnZW9PYmplY3RzOiBRdWVyeUxpc3Q8WWFHZW9PYmplY3REaXJlY3RpdmU+O1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IGRlc3Ryb3kkID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBldmVudE1hbmFnZXIgPSBuZXcgRXZlbnRNYW5hZ2VyKHRoaXMubmdab25lKTtcclxuXHJcbiAgcHJpdmF0ZSBjbHVzdGVyZXI/OiB5bWFwcy5DbHVzdGVyZXI7XHJcblxyXG4gIC8qKlxyXG4gICAqIENsdXN0ZXJlciBvcHRpb25zLiBPcHRpb25zIGZvciBjaGlsZCBjbHVzdGVyIG9iamVjdHMgYXJlIHNldCB3aXRoIHRoZSBcImNsdXN0ZXJcIiBwcmVmaXguXHJcbiAgICoge0BsaW5rIGh0dHBzOi8veWFuZGV4LmNvbS9kZXYvbWFwcy9qc2FwaS9kb2MvMi4xL3JlZi9yZWZlcmVuY2UvQ2x1c3RlcmVyLmh0bWwjQ2x1c3RlcmVyX19wYXJhbS1vcHRpb25zfVxyXG4gICAqL1xyXG4gIEBJbnB1dCgpIG9wdGlvbnM6IHltYXBzLklDbHVzdGVyZXJPcHRpb25zO1xyXG5cclxuICAvKipcclxuICAgKiBDbHVzdGVyZXIgaW5zdGFuY2UgaXMgYWRkZWQgdG8gYSBNYXAuXHJcbiAgICovXHJcbiAgQE91dHB1dCgpIHJlYWR5OiBFdmVudEVtaXR0ZXI8WWFSZWFkeUV2ZW50PHltYXBzLkNsdXN0ZXJlcj4+ID0gbmV3IEV2ZW50RW1pdHRlcjxcclxuICAgIFlhUmVhZHlFdmVudDx5bWFwcy5DbHVzdGVyZXI+XHJcbiAgPigpO1xyXG5cclxuICAvKipcclxuICAgKiBDbG9zaW5nIHRoZSBoaW50LlxyXG4gICAqIHtAbGluayBodHRwczovL3lhbmRleC5jb20vZGV2L21hcHMvanNhcGkvZG9jLzIuMS9yZWYvcmVmZXJlbmNlL0NsdXN0ZXJlci5odG1sI2V2ZW50X2RldGFpbF9fZXZlbnQtaGludGNsb3NlfVxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSBoaW50Y2xvc2U6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5DbHVzdGVyZXI+PiA9XHJcbiAgICB0aGlzLmV2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignaGludGNsb3NlJyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIE9wZW5pbmcgYSBoaW50IG9uIGEgbWFwLlxyXG4gICAqIHtAbGluayBodHRwczovL3lhbmRleC5jb20vZGV2L21hcHMvanNhcGkvZG9jLzIuMS9yZWYvcmVmZXJlbmNlL0NsdXN0ZXJlci5odG1sI2V2ZW50X2RldGFpbF9fZXZlbnQtaGludG9wZW59XHJcbiAgICovXHJcbiAgQE91dHB1dCgpIGhpbnRvcGVuOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuQ2x1c3RlcmVyPj4gPVxyXG4gICAgdGhpcy5ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ2hpbnRvcGVuJyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIE1hcCByZWZlcmVuY2UgY2hhbmdlZC5cclxuICAgKiB7QGxpbmsgaHR0cHM6Ly95YW5kZXguY29tL2Rldi9tYXBzL2pzYXBpL2RvYy8yLjEvcmVmL3JlZmVyZW5jZS9JUGFyZW50T25NYXAuaHRtbCNldmVudF9kZXRhaWxfX2V2ZW50LW1hcGNoYW5nZX1cclxuICAgKi9cclxuICBAT3V0cHV0KCkgbWFwY2hhbmdlOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuQ2x1c3RlcmVyPj4gPVxyXG4gICAgdGhpcy5ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ21hcGNoYW5nZScpO1xyXG5cclxuICAvKipcclxuICAgKiBDaGFuZ2UgdG8gdGhlIG9iamVjdCBvcHRpb25zLlxyXG4gICAqIHtAbGluayBodHRwczovL3lhbmRleC5jb20vZGV2L21hcHMvanNhcGkvZG9jLzIuMS9yZWYvcmVmZXJlbmNlL0lDdXN0b21pemFibGUuaHRtbCNldmVudF9kZXRhaWxfX2V2ZW50LW9wdGlvbnNjaGFuZ2V9XHJcbiAgICovXHJcbiAgQE91dHB1dCgpIG9wdGlvbnNjaGFuZ2U6IE9ic2VydmFibGU8WWFFdmVudDx5bWFwcy5DbHVzdGVyZXI+PiA9XHJcbiAgICB0aGlzLmV2ZW50TWFuYWdlci5nZXRMYXp5RW1pdHRlcignb3B0aW9uc2NoYW5nZScpO1xyXG5cclxuICAvKipcclxuICAgKiBUaGUgcGFyZW50IG9iamVjdCByZWZlcmVuY2UgY2hhbmdlZC5cclxuICAgKiB7QGxpbmsgaHR0cHM6Ly95YW5kZXguY29tL2Rldi9tYXBzL2pzYXBpL2RvYy8yLjEvcmVmL3JlZmVyZW5jZS9JQ2hpbGQuaHRtbCNldmVudF9kZXRhaWxfX2V2ZW50LXBhcmVudGNoYW5nZX1cclxuICAgKi9cclxuICBAT3V0cHV0KCkgcGFyZW50Y2hhbmdlOiBPYnNlcnZhYmxlPFlhRXZlbnQ8eW1hcHMuQ2x1c3RlcmVyPj4gPVxyXG4gICAgdGhpcy5ldmVudE1hbmFnZXIuZ2V0TGF6eUVtaXR0ZXIoJ3BhcmVudGNoYW5nZScpO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IG5nWm9uZTogTmdab25lLCBwcml2YXRlIHJlYWRvbmx5IHlhTWFwQ29tcG9uZW50OiBZYU1hcENvbXBvbmVudCkge31cclxuXHJcbiAgLyoqXHJcbiAgICogSGFuZGxlcyBpbnB1dCBjaGFuZ2VzIGFuZCBwYXNzZXMgdGhlbSBpbiBBUEkuXHJcbiAgICogQHBhcmFtIGNoYW5nZXNcclxuICAgKi9cclxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XHJcbiAgICBjb25zdCB7IGNsdXN0ZXJlciB9ID0gdGhpcztcclxuXHJcbiAgICBpZiAoY2x1c3RlcmVyKSB7XHJcbiAgICAgIGNvbnN0IHsgb3B0aW9ucyB9ID0gY2hhbmdlcztcclxuXHJcbiAgICAgIGlmIChvcHRpb25zKSB7XHJcbiAgICAgICAgY2x1c3RlcmVyLm9wdGlvbnMuc2V0KG9wdGlvbnMuY3VycmVudFZhbHVlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbmdBZnRlckNvbnRlbnRJbml0KCk6IHZvaWQge1xyXG4gICAgdGhpcy55YU1hcENvbXBvbmVudC5tYXAkXHJcbiAgICAgIC5waXBlKGZpbHRlcihCb29sZWFuKSwgdGFrZSgxKSwgdGFrZVVudGlsKHRoaXMuZGVzdHJveSQpKVxyXG4gICAgICAuc3Vic2NyaWJlKChtYXApID0+IHtcclxuICAgICAgICBjb25zdCBjbHVzdGVyZXIgPSB0aGlzLmNyZWF0ZUNsdXN0ZXJlcigpO1xyXG4gICAgICAgIHRoaXMuY2x1c3RlcmVyID0gY2x1c3RlcmVyO1xyXG5cclxuICAgICAgICBtYXAuZ2VvT2JqZWN0cy5hZGQoY2x1c3RlcmVyKTtcclxuICAgICAgICB0aGlzLmV2ZW50TWFuYWdlci5zZXRUYXJnZXQoY2x1c3RlcmVyKTtcclxuICAgICAgICB0aGlzLndhdGNoRm9yQ29udGVudENoYW5nZXMoY2x1c3RlcmVyKTtcclxuICAgICAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4gdGhpcy5yZWFkeS5lbWl0KHsgeW1hcHMsIHRhcmdldDogY2x1c3RlcmVyIH0pKTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZXZlbnRNYW5hZ2VyLmRlc3Ryb3koKTtcclxuICAgIHRoaXMuZGVzdHJveSQubmV4dCgpO1xyXG4gICAgdGhpcy5kZXN0cm95JC5jb21wbGV0ZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlcyBDbHVzdGVyZXIuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjcmVhdGVDbHVzdGVyZXIoKTogeW1hcHMuQ2x1c3RlcmVyIHtcclxuICAgIHJldHVybiBuZXcgeW1hcHMuQ2x1c3RlcmVyKHRoaXMub3B0aW9ucyk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHdhdGNoRm9yQ29udGVudENoYW5nZXMoY2x1c3RlcmVyOiB5bWFwcy5DbHVzdGVyZXIpOiB2b2lkIHtcclxuICAgIC8vIEFkZHMgbmV3IFBsYWNlbWFya3MgdG8gdGhlIGNsdXN0ZXJlciBvbiBjaGFuZ2VzLlxyXG4gICAgY29uc3QgY3VycmVudFBsYWNlbWFya3MgPSBuZXcgU2V0PHltYXBzLlBsYWNlbWFyaz4oKTtcclxuXHJcbiAgICB0aGlzLmdldEludGVybmFsUGxhY2VtYXJrcyh0aGlzLnBsYWNlbWFya3MudG9BcnJheSgpKS5mb3JFYWNoKChwbGFjZW1hcmspID0+IHtcclxuICAgICAgY3VycmVudFBsYWNlbWFya3MuYWRkKHBsYWNlbWFyayk7XHJcbiAgICAgIGNsdXN0ZXJlci5hZGQocGxhY2VtYXJrKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMucGxhY2VtYXJrcy5jaGFuZ2VzXHJcbiAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSlcclxuICAgICAgLnN1YnNjcmliZSgocGxhY2VtYXJrRGlyZWN0aXZlczogWWFQbGFjZW1hcmtEaXJlY3RpdmVbXSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IG5ld1BsYWNlbWFya3MgPSBuZXcgU2V0PHltYXBzLlBsYWNlbWFyaz4oXHJcbiAgICAgICAgICB0aGlzLmdldEludGVybmFsUGxhY2VtYXJrcyhwbGFjZW1hcmtEaXJlY3RpdmVzKSxcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBjb25zdCBkaWZmZXJlbmNlID0gdGhpcy5nZXREaWZmZXJlbmNlPHltYXBzLlBsYWNlbWFyaz4obmV3UGxhY2VtYXJrcywgY3VycmVudFBsYWNlbWFya3MpO1xyXG5cclxuICAgICAgICBjbHVzdGVyZXIuYWRkKGRpZmZlcmVuY2UudG9BZGQpO1xyXG4gICAgICAgIGNsdXN0ZXJlci5yZW1vdmUoZGlmZmVyZW5jZS50b1JlbW92ZSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIC8vIEFkZHMgbmV3IEdlb09iamVjdHMgdG8gdGhlIGNsdXN0ZXJlciBvbiBjaGFuZ2VzLlxyXG4gICAgY29uc3QgY3VycmVudEdlb09iamVjdHMgPSBuZXcgU2V0PHltYXBzLkdlb09iamVjdD4oKTtcclxuXHJcbiAgICB0aGlzLmdldEludGVybmFsR2VvT2JqZWN0cyh0aGlzLmdlb09iamVjdHMudG9BcnJheSgpKS5mb3JFYWNoKChnZW9PYmplY3QpID0+IHtcclxuICAgICAgY3VycmVudEdlb09iamVjdHMuYWRkKGdlb09iamVjdCk7XHJcbiAgICAgIGNsdXN0ZXJlci5hZGQoZ2VvT2JqZWN0KTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMuZ2VvT2JqZWN0cy5jaGFuZ2VzXHJcbiAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSlcclxuICAgICAgLnN1YnNjcmliZSgoZ2VvT2JqZWN0RGlyZWN0aXZlczogWWFHZW9PYmplY3REaXJlY3RpdmVbXSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IG5ld0dlb09iamVjdHMgPSBuZXcgU2V0PHltYXBzLkdlb09iamVjdD4oXHJcbiAgICAgICAgICB0aGlzLmdldEludGVybmFsR2VvT2JqZWN0cyhnZW9PYmplY3REaXJlY3RpdmVzKSxcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBjb25zdCBkaWZmZXJlbmNlID0gdGhpcy5nZXREaWZmZXJlbmNlPHltYXBzLkdlb09iamVjdD4obmV3R2VvT2JqZWN0cywgY3VycmVudEdlb09iamVjdHMpO1xyXG5cclxuICAgICAgICBjbHVzdGVyZXIuYWRkKGRpZmZlcmVuY2UudG9BZGQpO1xyXG4gICAgICAgIGNsdXN0ZXJlci5yZW1vdmUoZGlmZmVyZW5jZS50b1JlbW92ZSk7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGV0ZXJtaW5lcyB3aGF0IHNob3VsZCBiZSBhZGRlZC9yZW1vdmVkIGluIGN1cnJlbnQgc2V0IHRvIGVxdWFsIG5ldyBzZXRcclxuICAgKlxyXG4gICAqIEBwYXJhbSBuZXdTZXRcclxuICAgKiBAcGFyYW0gY3VycmVudFNldFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0RGlmZmVyZW5jZTxUPihuZXdTZXQ6IFNldDxUPiwgY3VycmVudFNldDogU2V0PFQ+KSB7XHJcbiAgICBjb25zdCB0b0FkZDogVFtdID0gW107XHJcbiAgICBjb25zdCB0b1JlbW92ZTogVFtdID0gW107XHJcblxyXG4gICAgbmV3U2V0LmZvckVhY2goKGNvbXBvbmVudCkgPT4ge1xyXG4gICAgICBpZiAoIWN1cnJlbnRTZXQuaGFzKGNvbXBvbmVudCkpIHtcclxuICAgICAgICB0b0FkZC5wdXNoKGNvbXBvbmVudCk7XHJcbiAgICAgICAgY3VycmVudFNldC5hZGQoY29tcG9uZW50KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgY3VycmVudFNldC5mb3JFYWNoKChjb21wb25lbnQpID0+IHtcclxuICAgICAgaWYgKCFuZXdTZXQuaGFzKGNvbXBvbmVudCkpIHtcclxuICAgICAgICB0b1JlbW92ZS5wdXNoKGNvbXBvbmVudCk7XHJcbiAgICAgICAgY3VycmVudFNldC5kZWxldGUoY29tcG9uZW50KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdG9BZGQsXHJcbiAgICAgIHRvUmVtb3ZlLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0SW50ZXJuYWxQbGFjZW1hcmtzKHBsYWNlbWFya3M6IFlhUGxhY2VtYXJrRGlyZWN0aXZlW10pOiB5bWFwcy5QbGFjZW1hcmtbXSB7XHJcbiAgICByZXR1cm4gcGxhY2VtYXJrc1xyXG4gICAgICAuZmlsdGVyKChjb21wb25lbnQpID0+ICEhY29tcG9uZW50LnBsYWNlbWFyaylcclxuICAgICAgLm1hcCgoY29tcG9uZW50KSA9PiBjb21wb25lbnQucGxhY2VtYXJrISk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEludGVybmFsR2VvT2JqZWN0cyhnZW9PYmplY3RzOiBZYUdlb09iamVjdERpcmVjdGl2ZVtdKTogeW1hcHMuR2VvT2JqZWN0W10ge1xyXG4gICAgcmV0dXJuIGdlb09iamVjdHNcclxuICAgICAgLmZpbHRlcigoY29tcG9uZW50KSA9PiAhIWNvbXBvbmVudC5nZW9PYmplY3QpXHJcbiAgICAgIC5tYXAoKGNvbXBvbmVudCkgPT4gY29tcG9uZW50Lmdlb09iamVjdCEpO1xyXG4gIH1cclxufVxyXG4iXX0=